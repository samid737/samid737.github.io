!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("PathBuilder",[],e):"object"==typeof exports?exports.PathBuilder=e():t.PathBuilder=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e){var i=function(t,e,i){this.ui=t,this.scene=t.scene,this.x=e,this.y=i,this.ui.elements.push(this),this.scene.cameras.main.ignore(this);var s=1<<this.scene.cameras.cameras.length-1;return this.cameraFilter=s&~this.ui.camera._id,this};i.prototype.update=function(){},i.prototype.toggle=function(){this.visible=!this.visible},i.prototype.click=function(){var t=this.callbackcontext,e=this.args;this.callbacks instanceof Array?this.callbacks.forEach(function(i,s){i.apply(t[s],e)}):this.callbacks.apply(this.callbackcontext,this.args)},i.prototype.hover=function(){},i.prototype.out=function(){},t.exports=i},function(t,e,i){var s=i(0),n=function(t,e,i,n){s.call(this,t,e.x,e.y),Phaser.GameObjects.Image.call(this,t.scene,e.x,e.y,i),this.setInteractive(),this.scene.input.setDraggable(this),this.setData("vector",e),this.scene.vectors.push(e),n&&(this.mapping=n),this.on("pointerout",function(t,e){this.scene.pointer.lbl.visible=!0}),this.on("drag",function(t,e){if(this.x=this.scene.pointer.x,this.y=this.scene.pointer.y,this.scene.pointer.lbl.visible=!1,this.data.get("vector").set(this.x,this.y),this.mapping){var i=this.mapping;for(var s in i.data)i.src[i.data[s].property]=i.data[s].operator(i.src,this[s])}this.scene.graphics.clear(),this.scene.draw()}),this.lbl=this.ui.add.label(this.x+10,this.y+10,"").setFontStyle(PathBuilder.UI.fonts.Point)};n.prototype=Object.create(Phaser.GameObjects.Image.prototype),Object.assign(n.prototype,s.prototype),n.prototype.constructor=n,n.prototype.update=function(){this.lbl.x=this.x+10,this.lbl.y=this.y+10,this.lbl.setText("x: "+this.x+" y: "+this.y)},t.exports=n},function(t,e,i){var s=i(4),n=i(1),o=i(5),h=i(6),r=i(7),a=function(t){this.scene=t,this.elements=[],this.add={text:function(t,e,i,n,o,h,r,a,l){var c=new s(this.ui,t,e,i,n,o,h,r,a,l);return this.ui.scene.add.existing(c),c},point:function(t,e,i){var s=new n(this.ui,t,e,i);return this.ui.scene.add.existing(s),s},endpoint:function(t,e,i){var s=new o(this.ui,t,e,i);return this.ui.scene.add.existing(s),s},controlpoint:function(t,e,i){var s=new h(this.ui,t,e,i);return this.ui.scene.add.existing(s),s},label:function(t,e,i,s,n,o,h){var a=new r(this.ui,t,e,i,s,n,o,h);return this.ui.scene.add.existing(a),a}},this.add.ui=this,this.camera=this.scene.cameras.add()};a.fonts={Button:{fontFamily:"Arial",fontSize:16,color:"#00ff00"},Point:{fontFamily:"Arial",fontSize:12,color:"#00ff00"},EndPoint:{fontFamily:"Arial",fontSize:12,color:"#00ff00"},ControlPoint:{fontFamily:"Arial",fontSize:10,color:"#00ff00"},Label:{fontFamily:"Arial",fontSize:16,color:"#ffff00"}},(a.prototype={hide:function(){this.elements.forEach(function(t){t.visible=!1}),this.scene.switchmode("normal"),this.translate(0,800,400,this.scene.unfreeze)},show:function(){this.elements.forEach(function(t){t.visible=!0}),this.scene.switchmode("normal"),this.translate(0,0,400,this.scene.freeze)},translate:function(t,e,i,s){this.scene.tweens.add({targets:this.camera,scrollX:t,scrollY:e,duration:i,ease:"Cubic.easeOut",onComplete:s,onCompleteParams:[this.scene]})},update:function(){this.elements.forEach(function(t){t.update()})},destroy:function(){this.elements.forEach(function(t){t.destroy()})}}).constructor=a,t.exports=a},function(t,e,i){var s=function(t){this.scene=t,this.systems=t.sys,t.sys.settings.isBooted||t.sys.events.on("boot",this.boot,this)};s.UI=i(2),s.Scene=i(8),s.register=function(t){t.register("PathBuilder",s,"curveGenerator")},(s.prototype={boot:function(){var t=this.systems.events;t.on("shutdown",this.shutdown,this),t.on("destroy",this.destroy,this),this.scene.sys.game.scene.add("UI",s.Scene,!0)},shutdown:function(){},destroy:function(){this.shutdown(),this.scene=void 0}}).constructor=s,t.exports=s},function(t,e,i){var s=i(0),n=function(t,e,i,n,o,h,r,a,l,c){return s.call(this,t,e,i),Phaser.GameObjects.Text.call(this,t.scene,e,i,n,PathBuilder.UI.fonts.Button),this.target=r,this.callbacks=a,this.args=l,this.callbackcontext=c,this.tween=null,this.setInteractive(),this.on("pointerdown",function(t,e){this.click()}),this.on("pointerover",function(t,e){this.hover()}),this.on("pointerout",function(t,e){this.out()}),this};n.prototype=Object.create(Phaser.GameObjects.Text.prototype),Object.assign(n.prototype,s.prototype),n.prototype.click=function(){s.prototype.click.call(this),this.tween=this.scene.tweens.add({targets:this,scaleX:1.2,scaleY:1.2,duration:100,ease:"Linear",yoyo:!0})},n.prototype.hover=function(){s.prototype.hover.call(this),this.setScale(1.1,1.1)},n.prototype.out=function(){s.prototype.out.call(this),this.setScale(1,1)},t.exports=n},function(t,e,i){var s=i(1),n=function(t,e,i,n,o){s.call(this,t,e,i,n,o),this.lbl.setFontStyle(PathBuilder.UI.fonts.EndPoint)};(n.prototype=s.prototype).constructor=n,t.exports=n},function(t,e,i){var s=i(1),n=function(t,e,i,n,o){s.call(this,t,e,i,n,o),this.setScale(.75,.75),this.lbl.setFontStyle(PathBuilder.UI.fonts.ControlPoint),this.lbl.visible=!1,this.on("pointermove",function(t,e){this.lbl.visible=!0}),this.on("pointerout",function(t,e){this.lbl.visible=!1}),this.on("dragend",function(t,e){this.lbl.visible=!1})};(n.prototype=s.prototype).constructor=n,t.exports=n},function(t,e,i){var s=i(0),n=function(t,e,i,n,o,h,r,a){return s.call(this,t,e,i),Phaser.GameObjects.Text.call(this,t.scene,e,i,n,PathBuilder.UI.fonts.Label),this.target=o,this.callbacks=h,this.callbackcontext=a,this.args=r,this.tween=null,this.setInteractive(),this};n.prototype=Object.create(Phaser.GameObjects.Text.prototype),Object.assign(n.prototype,s.prototype),t.exports=n},function(t,e,i){var s=i(2),n=i(9),o=function(){};o.prototype={preload:function(){},create:function(){this.tool={normal:null,draw:this.place},this.mode="normal",this.curves={Line:Phaser.Curves.Line,Ellipse:Phaser.Curves.Ellipse,QuadraticBezier:Phaser.Curves.QuadraticBezier,CubicBezier:Phaser.Curves.CubicBezier,Spline:Phaser.Curves.Spline},this.events.emit("switchmode",this.mode),this.drawmode="CubicBezier",this.vectors=[],this.spline=null,this.path=this.add.path(),this.path.segments=32,this.graphics=this.add.graphics(),this.drawpanel=new s(this),this.middle=new s(this),this.top=new s(this),this.graphics.fillStyle(16711680,1),this.graphics.fillCircle(10,10,8),this.graphics.generateTexture("endpoint",32,32),this.graphics.fillStyle(65280,1),this.graphics.fillCircle(10,10,8),this.graphics.generateTexture("controlpoint",32,32),this.graphics.clear(),this.hidebutton=this.top.add.text(10,300,"hide",null,null,null,[this.drawpanel.hide,this.middle.hide],[],[this.drawpanel,this.middle]),this.showbutton=this.top.add.text(10,350,"show",null,null,null,[this.drawpanel.show,this.middle.show],[],[this.drawpanel,this.middle]),this.drawbutton=this.middle.add.text(10,200,"draw",null,null,null,this.switchmode,["draw"],this),this.clearbutton=this.middle.add.text(10,100,"clear",null,null,null,this.clear,[],this),this.importbutton=this.middle.add.text(700,400,"import",null,null,null,this.import,[],this),this.exportbutton=this.middle.add.text(700,500,"export",null,null,null,this.export,[],this),this.previewbutton=this.middle.add.text(10,500,"preview",null,null,null,this.preview,[],this),this.modelabel=this.middle.add.label(100,20,"mode: ",null,null,null,null,this),this.drawmodelabel=this.middle.add.label(400,20,"curve: "+this.drawmode,null,null,null,null,this),this.pointer=new n(this.middle,100,100,"controlpoint"),this.setCameras(),this.drawpanel.hide(),this.middle.hide()},update:function(){this.drawpanel.update(),this.pointer.update()},setCameras:function(){this.drawpanel.camera.ignore(this.middle.elements),this.drawpanel.camera.ignore(this.top.elements),this.middle.camera.ignore(this.graphics),this.middle.camera.ignore(this.drawpanel.elements),this.middle.camera.ignore(this.top.elements),this.top.camera.ignore(this.graphics),this.top.camera.ignore(this.middle.elements),this.top.camera.ignore(this.drawpanel.elements),this.cameras.main.ignore(this.children.list)},switchmode:function(t){this.mode=t,this.modelabel.setText("mode: "+this.mode),this.events.emit("switchmode",this.mode)},clear:function(){this.vectors=[],this.drawpanel.elements.forEach(function(t){t.destroy()}),this.drawpanel.elements=[],this.graphics.clear(),this.path.destroy()},place:function(t,e,i){var s=new Phaser.Math.Vector2(e,i);if(0!=this.vectors.length){if("Line"==this.drawmode){this.spline=null;var n=this.vectors[this.vectors.length-1];if(this.vectors.length>1){var o=new this.curves[this.drawmode](n,s);this.path.add(o)}this.point=t.add.endpoint(s,"endpoint")}if("QuadraticBezier"==this.drawmode){this.spline=null;var h=new Phaser.Math.Vector2(e,i);n=this.vectors[this.vectors.length-1];h=(h=h.add(n)).divide(new Phaser.Math.Vector2(2,2));o=new this.curves[this.drawmode](n,h,s);this.path.add(o),this.point=t.add.controlpoint(h,"controlpoint"),this.point=t.add.endpoint(s,"endpoint")}if("CubicBezier"==this.drawmode){this.spline=null;var r=new Phaser.Math.Vector2(e,i),a=new Phaser.Math.Vector2(e,i);n=this.vectors[this.vectors.length-1];r.x=n.x+.25*(e-n.x),r.y=n.y+.25*(i-n.y),a.x=n.x+.75*(e-n.x),a.y=n.y+.75*(i-n.y);o=new this.curves[this.drawmode](n,r,a,s);this.path.add(o),this.point=t.add.controlpoint(r,"controlpoint"),this.point=t.add.controlpoint(a,"controlpoint"),this.point=t.add.endpoint(s,"endpoint")}if("Spline"==this.drawmode){n=this.vectors[this.vectors.length-1];if(null==this.spline){o=new this.curves[this.drawmode]([n.x,n.y,s.x,s.y]);this.spline=o,this.path.add(o)}this.path.segments+=8,1==this.vectors.length?this.point=t.add.controlpoint(s,"controlpoint"):(this.point=t.add.controlpoint(s,"controlpoint"),this.spline.addPoints([s.x,s.y])),this.spline.points[this.spline.points.length-1]=s,this.spline.points[this.spline.points.length-2]=n}if("Ellipse"==this.drawmode){this.spline=null;n=this.vectors[this.vectors.length-1],o=new this.curves[this.drawmode];this.path.add(o),o.p0=s;var l=new Phaser.Math.Vector2(s.x+100,s.y+100);this.point=t.add.endpoint(s,"endpoint"),this.point=t.add.controlpoint(l,"controlpoint",{src:o,data:{x:{property:"xRadius",operator:function(t,e){return t.p0.x-e}},y:{property:"yRadius",operator:function(t,e){return t.p0.y-e}}}});new Phaser.Math.Vector2(o.p0.x,o.p0.y+o.yRadius)}this.draw(),this.setCameras()}else this.point=t.add.endpoint(s,"endpoint")},move:function(t,e){},draw:function(){this.graphics.clear(),this.graphics.lineStyle(2,16777215,1),this.graphics.fillStyle(16777215,1),this.path.draw(this.graphics,this.path.segments)},freeze:function(t,e,i){i.scene.manager.scenes[0].scene.pause()},unfreeze:function(t,e,i){i.scene.manager.scenes[0].scene.resume()},import:function(){var t=this.cache.json.get("data");this.path=this.path.fromJSON(t),this.draw()},export:function(){var t=JSON.stringify(this.path.toJSON());console.log(t);var e=new Blob([t],["data.json"]),i=URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download="data.json",s.click()},preview:function(){if(0!==this.path.curves.length){var t=this.add.follower(this.path,0,0,"dude");t.start({duration:2e3,rotateToPath:!0,yoyo:!0,onComplete:function(t,e,i){i.destroy()},onCompleteParams:[t],ease:"Cubic.easeInOut"})}},destroy:function(){}},t.exports=o},function(t,e,i){var s=i(0),n=function(t,e,i,n,o){s.call(this,t,e,i),Phaser.GameObjects.Image.call(this,t.scene,e,i,n),this.alpha=.5,this.snap=50,this.scene.input.on("pointerdown",function(t,e){"draw"==this.scene.mode&&0==t.dragState&&0==e.length&&t.x>50&&t.x<700&&this.scene.place(this.scene.drawpanel,this.x,this.y)},this),this.snapkey=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.lbl=this.ui.add.label(e+20,i+20,"").setFontStyle(PathBuilder.UI.fonts.Label),this.linebutton=this.ui.add.text(e,i,"Line",null,null,null,this.switchdrawmode,["Line"],this).setFontStyle(PathBuilder.UI.fonts.Button),this.quadbutton=this.ui.add.text(e,i,"Quadratic",null,null,null,this.switchdrawmode,["QuadraticBezier"],this).setFontStyle(PathBuilder.UI.fonts.Button),this.cubicbutton=this.ui.add.text(e,i,"Cubic",null,null,null,this.switchdrawmode,["CubicBezier"],this).setFontStyle(PathBuilder.UI.fonts.Button),this.splinebutton=this.ui.add.text(e,i,"Spline",null,null,null,this.switchdrawmode,["Spline"],this).setFontStyle(PathBuilder.UI.fonts.Button),this.ellipsebutton=this.ui.add.text(e,i,"Ellipse",null,null,null,this.switchdrawmode,["Ellipse"],this).setFontStyle(PathBuilder.UI.fonts.Button),this.menu=[this.linebutton,this.quadbutton,this.cubicbutton,this.splinebutton,this.ellipsebutton],this.menu.forEach(function(t){t.setVisible(!1)}),this.scene.events.on("switchmode",this.switchmode,this),this.scene.add.existing(this)};n.prototype=Object.create(Phaser.GameObjects.Image.prototype),Object.assign(n.prototype,s.prototype),n.prototype.constructor=n,n.prototype.switchmode=function(t){"draw"==t&&(this.setVisible(!0),this.lbl.setVisible(!0)),"normal"==t&&(this.setVisible(!1),this.menu.forEach(function(t){t.setVisible(!1)})),"select"==t&&(this.setVisible(!1),this.menu.forEach(function(t){t.setVisible(!0)}))},n.prototype.switchdrawmode=function(t){this.scene.drawmode=t,this.scene.drawmodelabel.setText("curve: "+t),this.menu.forEach(function(t){t.setVisible(!1)}),this.scene.switchmode("draw")},n.prototype.update=function(){(this.x=this.scene.input.activePointer.x,this.y=this.scene.input.activePointer.y,this.scene.input.activePointer.isDown&&0==this.scene.input.activePointer.dragState)&&(this.scene.time.now-this.scene.input.activePointer.downTime>500&&"select"!==this.scene.mode&&this.scene.switchmode("select"));this.snapkey.isDown&&(this.x=Math.round(this.x/this.snap)*this.snap,this.y=Math.round(this.y/this.snap)*this.snap),"select"!==this.scene.mode&&(this.linebutton.setPosition(this.x-50,this.y-50),this.quadbutton.setPosition(this.x,this.y-50),this.cubicbutton.setPosition(this.x+50,this.y-50),this.splinebutton.setPosition(this.x-50,this.y+50),this.ellipsebutton.setPosition(this.x,this.y+50)),this.lbl.setPosition(this.x+20,this.y+20),this.lbl.setText("x: "+this.x+" y: "+this.y)},t.exports=n}])});